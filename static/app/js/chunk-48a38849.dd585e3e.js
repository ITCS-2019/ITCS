(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48a38849"],{"0a49":function(t,e,a){var i=a("9b43"),n=a("626a"),o=a("4bf8"),c=a("9def"),r=a("cd1c");t.exports=function(t,e){var a=1==t,s=2==t,l=3==t,d=4==t,u=6==t,f=5==t||u,m=e||r;return function(e,r,g){for(var p,v,b=o(e),h=n(b),k=i(r,g,3),w=c(h.length),C=0,y=a?m(e,w):s?m(e,0):void 0;w>C;C++)if((f||C in h)&&(p=h[C],v=k(p,C,b),t))if(a)y[C]=v;else if(v)switch(t){case 3:return!0;case 5:return p;case 6:return C;case 2:y.push(p)}else if(d)return!1;return u?-1:l||d?d:y}}},"41f3":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{"fill-height":"",fluid:"","grid-list-xl":"","pt-0":""}},[a("v-layout",{attrs:{"justify-center":"",wrap:""}},[a("v-flex",{attrs:{md12:""}},[a("material-card",[a("v-layout",{attrs:{id:"grid-controls","justify-space-between":"",wrap:""}},[a("div",[a("v-menu",{attrs:{"offset-y":"","content-class":"dropdown-menu",transition:"slide-y-transition"}},[a("v-btn",{attrs:{slot:"activator",color:"success",small:""},slot:"activator"},[a("v-icon",{attrs:{left:""}},[t._v("\n                  mdi-file-excel\n                ")]),a("span",{staticClass:"font-weight-bold ml-1"},[t._v("\n                  Excel\n                ")])],1),a("v-card",[a("v-list",{attrs:{dense:""}},[a("v-list-tile",{key:"all",on:{click:function(e){return t.exportGrid(!1,"XLSExp")}}},[a("v-list-tile-title",{domProps:{textContent:t._s("Експортувати все")}})],1),a("v-list-tile",{key:"checked",on:{click:function(e){return t.exportGrid(!0,"XLSExp")}}},[a("v-list-tile-title",{domProps:{textContent:t._s("Експортувати обране")}})],1)],1)],1)],1),a("v-menu",{attrs:{"offset-y":"","content-class":"dropdown-menu",transition:"slide-y-transition"}},[a("v-btn",{attrs:{slot:"activator",color:"success",small:""},slot:"activator"},[a("v-icon",{attrs:{left:""}},[t._v("\n                  mdi-file-pdf\n                ")]),a("span",{staticClass:"font-weight-bold ml-1"},[t._v("\n                  PDF\n                ")])],1),a("v-card",[a("v-list",{attrs:{dense:""}},[a("v-list-tile",{key:"all",on:{click:function(e){return t.exportGrid(!1,"PdfExp")}}},[a("v-list-tile-title",{domProps:{textContent:t._s("Експортувати все")}})],1),a("v-list-tile",{key:"checked",on:{click:function(e){return t.exportGrid(!0,"PdfExp")}}},[a("v-list-tile-title",{domProps:{textContent:t._s("Експортувати обране")}})],1)],1)],1)],1),a("v-btn",{attrs:{color:"success",small:""},on:{click:function(e){return t.printGrid("certsGrid")}}},[a("v-icon",[t._v("\n                mdi-printer\n              ")]),a("span",{staticClass:"font-weight-bold ml-1"},[t._v("\n                Друкувати\n              ")])],1)],1),a("div",[a("v-btn",{attrs:{color:"success",small:""},on:{click:t.handleCerts}},[a("v-icon",[t._v("\n                mdi-file-move\n              ")]),a("span",{staticClass:"font-weight-bold ml-1"},[t._v("\n                В обробку\n              ")])],1),a("v-btn",{staticClass:"ml-1",attrs:{color:"warning",small:"",depressed:!0},on:{click:function(e){return t.showModal("Видалити обранi сертифiкати?")}}},[a("v-icon",[t._v("\n                mdi-trash-can\n              ")]),a("span",{staticClass:"font-weight-bold ml-1"},[t._v("\n                Видалити\n              ")])],1)],1)]),a("DxGrid",{ref:"certsGrid",attrs:{tableConfig:t.tableConfig}})],1)],1)],1),a("v-snackbar",{attrs:{color:t.snackbarConfig.color,top:!0,dark:""},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[a("v-icon",{staticClass:"mr-3",attrs:{color:"white"}},[t._v("\n      "+t._s(t.snackbarConfig.icon)+"\n    ")]),a("div",[t._v("\n      "+t._s(t.snackbarConfig.message)+"\n    ")]),a("v-icon",{attrs:{size:"16"},on:{click:function(e){t.snackbar=!1}}},[t._v("\n      mdi-close-circle\n    ")])],1),a("v-dialog",{attrs:{persistent:"","max-width":"290"},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[t._v("\n        Пiдтвердiть дiю\n      ")]),a("v-card-text",[t._v("\n        "+t._s(t.modalConfig.message)+"\n      ")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"green darken-1",flat:""},on:{click:t.removeCerts}},[t._v("\n          Так\n        ")]),a("v-btn",{attrs:{color:"red darken-1",flat:""},on:{click:function(e){t.modal=!1}}},[t._v("\n          Нi\n        ")])],1)],1)],1)],1)},n=[],o=(a("6762"),a("bd86")),c=(a("7514"),a("a481"),a("ac6a"),{data:function(){var t,e=this;return{modal:!1,modalConfig:{message:null},snackbar:!1,snackbarConfig:{color:null,icon:null,message:null},exportType:null,clickDelay:void 0,dataSource:[],tableConfig:(t={dataSource:[],allowColumnReordering:!1,allowColumnResizing:!0,columnAutoWidth:!1,showBorders:!0,showRowLines:!0,editing:{mode:"cell",allowUpdating:!0},selection:{mode:"multiple",showCheckBoxesMode:"always"},paging:{enabled:!0,pageSize:10},pager:{showPageSizeSelector:!0,allowedPageSizes:[10,20,50,100],showInfo:!0,visible:!0},searchPanel:{visible:!0,width:240,placeholder:"Шукати..."},export:{enabled:!1,fileName:"certificates",allowExportSelectedData:!0},rowAlternationEnabled:!0,customizeExportData:function(t,a){var i=[];if(a.length>0){a.forEach(function(t){i.push(t.data.certificateId)});var n=document.createElement("a");n.setAttribute("href","/mariner/api/exportToPrint/?exportType=".concat(e.exportType,"&certIDs=").concat(i.join(","))),n.setAttribute("target","_blank"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},onFileSaving:function(t){t.cancel=!0},headerFilter:{visible:!0},filterRow:{visible:!0,applyFilter:"auto"},hoverStateEnabled:!0,wordWrapEnabled:!0},Object(o["a"])(t,"columnAutoWidth",!0),Object(o["a"])(t,"onSelectionChanged",function(t){var e=t.component,a="multiple"===e._options.selection.mode?", Вибрано: ".concat(e.getSelectedRowKeys().length):"";e.option("pager.infoText","Всього: ".concat(e.option("dataSource").length).concat(a))}),Object(o["a"])(t,"onCellClick",function(t){var a=t.component,i=e;function n(){a.clickCount=1,a.clickKey=t.key,a.clickDate=new Date,i.clickDelay=setTimeout(function(){t.column.dataField&&(t.row.isSelected?a.deselectRows([t.key]):a.selectRows([t.key],!0))},300)}function o(){switch(clearTimeout(i.clickDelay),a.clickCount=0,a.clickKey=0,a.clickDate=null,t.column.dataField){case"certificateNumber":return void i.$router.push("/mariner/app/edit-certificate/".concat(t.data.certificateId));case"sailor":return void("НТЗ"===gUserRole?i.$router.push("/mariner/app/edit-certificate/".concat(t.data.certificateId)):window.location.replace("/mariner/sailor/".concat(t.data.sailorId)));case"trainigOrganisation":return void window.location.replace("/mariner/trainigOrganisation/".concat(t.data.trainigOrganisation))}t.column.dataField&&i.$router.push("/mariner/app/edit-certificate/".concat(t.data.certificateId))}a.clickCount&&1==a.clickCount&&a.clickKey==t.key?a.clickKey==t.key&&(new Date-a.clickDate<=300?o():n()):n()}),Object(o["a"])(t,"onContentReady",function(t){function e(e){t.component.pageIndex(e)}var a=$(".custom-pagination.custom-pagination--grid"),i=$(".custom-pagination__select",a),n=t.component.pageCount(),o=t.component.pageIndex(),c=$(".custom-pagination__btn--first-page",a),r=$(".custom-pagination__btn--last-page",a),s=$(".custom-pagination__btn--next",a),l=$(".custom-pagination__btn--prev",a),d=t.element.find(".dx-toolbar-items-container").length>0?t.element.find(".dx-datagrid-header-panel .dx-toolbar-items-container"):t.element.find(".dx-datagrid-header-panel"),u=$(".custom-pagination.custom-pagination--grid",d);if(n>1){i.empty();for(var f=0;f<n;f++)f===o?i.append('<option selected="selected" value="'.concat(f,'">').concat(f+1,"</option>>")):i.append('<option value="'.concat(f,'">').concat(f+1,"</option>>"));u.remove(),d.append(a),0===o?(c.attr("disabled",!0),l.attr("disabled",!0)):(c.attr("disabled",!1),l.attr("disabled",!1)),o+1===n?(r.attr("disabled",!0),s.attr("disabled",!0)):(r.attr("disabled",!1),s.attr("disabled",!1)),i.on("change",function(){e($(this).val(),n)}),c.on("click",function(){e(0,n)}),r.on("click",function(){e(n-1)}),s.on("click",function(){e(o+1)}),l.on("click",function(){e(o-1)}),a.fadeIn("fast")}}),Object(o["a"])(t,"columns",[{dataField:"certificateId",visible:!1,allowExporting:!1},{dataField:"certificateNumber",caption:"№ Сертифіката",allowEditing:!1,allowFiltering:!0},{dataField:"blankNumber",caption:"№ Бланку",allowEditing:!1,allowFiltering:!0},{dataField:"issueDate",caption:"Дата видачі",dataType:"date",allowEditing:!1,format:"dd.MM.yyyy"},{dataField:"validDate",caption:"Дійсний до",dataType:"date",allowEditing:!1,format:"dd.MM.yyyy"},{dataField:"certificateNumberGenerated",caption:"№ сертифіката(сген.)",allowEditing:!1,visible:!1},{dataField:"trainingDirection",caption:"Напрямок підготовки",allowEditing:!1,allowFiltering:!0},{dataField:"sailorId",visible:!1},{dataField:"sailor",caption:"Моряк",allowEditing:!1,allowFiltering:!0},{dataField:"trainigOrganisation",caption:"НТЗ",allowEditing:!1,allowFiltering:!0,visible:"НТЗ"!==gUserRole},{dataField:"status",caption:"Статус",allowEditing:!1}]),t)}},mounted:function(){var t=this;axios.get("/mariner/api/certificates/").then(function(e){var a=e.data.certificates;a.forEach(function(e){var a;switch(e.status){case 0:a="Чернетка";break;case 1:a="Обробка";break;case 2:a="Видан";break;case 3:a="Анульований";break}t.dataSource.push({certificateId:e.id,certificateNumber:e.certf_number,blankNumber:e.form_number,issueDate:e.date_of_issue,validDate:e.valid_date,trainingDirection:e.training_direction.direction_title,sailorId:e.sailor_id,sailor:"".concat(e.first_name_ukr," ").concat(e.last_name_ukr),trainigOrganisation:e.trainigOrganisation_name,status:a})});var i=t.$refs.certsGrid.tableInstance,n="multiple"===i._options.selection.mode?", Вибрано: ".concat(i.getSelectedRowKeys().length):"";i.option("dataSource",t.dataSource),i.option("pager.infoText","Всього: ".concat(i.option("dataSource").length).concat(n)),i.endCustomLoading()}).catch(function(t){console.log(t)})},methods:{showModal:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.$refs.certsGrid.tableInstance,a=e.getSelectedRowsData();if(this.modalConfig.message=t,a.length>0){var i=!1;a.some(function(t){if("Чернетка"!==t.status)return i=!0,!0}),i?(this.snackbarConfig.icon="mdi-alert-circle",this.snackbarConfig.color="red",this.snackbarConfig.message='Можливо видаляти тiльки сертифiкати зi статусом "Чернетка"!',this.snackbar=!0):this.modal=!0}else this.snackbarConfig.icon="mdi-alert-circle",this.snackbarConfig.color="red",this.snackbarConfig.message="Не вибрано жодного сертифiката!",this.snackbar=!0},removeCerts:function(){var t=this,e=this.$refs.certsGrid.tableInstance,a=e.getSelectedRowsData(),i=[];this.modal=!1,a.some(function(t){i.push(t.certificateId)}),axios.get("/mariner/api/removeDraftCerts/",{params:{certIDs:i.join(",")}}).then(function(a){if(a.error)t.snackbarConfig.icon="mdi-alert-circle",t.snackbarConfig.color="red",t.snackbarConfig.message=a.error_message,t.snackbar=!0;else{t.snackbarConfig.icon="mdi-check-circle",t.snackbarConfig.color="success",t.snackbarConfig.message="Сертифiкати успiшно видаленi!",t.snackbar=!0;var n=t.dataSource.length;while(n--)i.includes(t.dataSource[n].certificateId)&&t.dataSource.splice(n,1);e.refresh()}}).catch(function(t){console.log(t)})},handleCerts:function(){var t=this,e=this.$refs.certsGrid.tableInstance,a=e.getSelectedRowsData();if(a.length>0){var i=!1,n=[];a.some(function(t){if("Чернетка"!==t.status)return i=!0,!0;n.push(t.certificateId)}),i?(this.snackbarConfig.icon="mdi-alert-circle",this.snackbarConfig.color="red",this.snackbarConfig.message='Змiнити статус на "Обробка" можливо тiльки для сертифiкатiв зi статусом "Чернетка"!',this.snackbar=!0):axios.get("/mariner/api/changeToReviewStatus/",{params:{certIDs:n.join(",")}}).then(function(a){a.error?(t.snackbarConfig.icon="mdi-alert-circle",t.snackbarConfig.color="red",t.snackbarConfig.message=a.error_message,t.snackbar=!0):(t.snackbarConfig.icon="mdi-check-circle",t.snackbarConfig.color="success",t.snackbarConfig.message="Сертифiкати успiшно вiдправленi в обробку!",t.snackbar=!0,t.dataSource.forEach(function(t){n.includes(t.certificateId)&&(t.status="Обробка")}),e.refresh())}).catch(function(t){console.log(t)})}else this.snackbarConfig.icon="mdi-alert-circle",this.snackbarConfig.color="red",this.snackbarConfig.message="Не вибрано жодного сертифiката!",this.snackbar=!0},exportGrid:function(t,e){var a=this.$refs.certsGrid.tableInstance;this.exportType=e,a.exportToExcel("boolean"===typeof t&&t)},printGrid:function(t){var e=this.$refs["".concat(t)].tableInstance._$element,a=$(".dx-datagrid-headers",e),i=$(".dx-datagrid-rowsview",e),n=window.open("","PRINT","height=400,width=600");return n.document.write("<html><head><title>"+document.title+"</title>"),n.document.write("</head><body >"),n.document.write("<h1>"+document.title+"</h1>"),n.document.write("".concat(a.html()).concat(i.html())),n.document.write("</body></html>"),n.document.close(),n.focus(),n.print(),n.close(),!0}}}),r=c,s=a("2877"),l=Object(s["a"])(r,i,n,!1,null,null,null);e["default"]=l.exports},7514:function(t,e,a){"use strict";var i=a("5ca1"),n=a("0a49")(5),o="find",c=!0;o in[]&&Array(1)[o](function(){c=!1}),i(i.P+i.F*c,"Array",{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(o)},cd1c:function(t,e,a){var i=a("e853");t.exports=function(t,e){return new(i(t))(e)}},e853:function(t,e,a){var i=a("d3f4"),n=a("1169"),o=a("2b4c")("species");t.exports=function(t){var e;return n(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!n(e.prototype)||(e=void 0),i(e)&&(e=e[o],null===e&&(e=void 0))),void 0===e?Array:e}}}]);
//# sourceMappingURL=chunk-48a38849.dd585e3e.js.map