{% extends 'crm_base.html' %}
{% load widget_tweaks %}
{% block title %} Моряк {% endblock %}

{% block styles %}
<link href="/static/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
<link href="/static/css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">

<link href="/static/css/plugins/toastr/toastr.min.css" rel="stylesheet">
{% endblock %}

{% block userName %}{{ userName }}{% endblock %}
{% block userGroup %}{{ userGroup }}{% endblock %}

{% block leftMenu %}
    <li>
        <a href="/mariner/"><i class="fa fa-th-large"></i> <span class="nav-label">Головна</span> </a>
    </li>
    <li>
        <a href="/mariner/trainigDirections/"><i class="fa fa-sitemap"></i> <span class="nav-label">Напрямки Підготовки</span> </a>
    </li>
    {% if user.groups.all.0.name != 'НТЗ' %}
    <li>
        <a href="/mariner/trainigOrganisations/"><i class="fa fa-pie-chart"></i> <span class="nav-label">НТЗ</span> </a>
    </li>
    {% endif %}
    {% if user.groups.all.0.name != 'НТЗ' %}
    <li class="active">
        <a href="/mariner/sailors/"><i class="fa fa-files-o"></i> <span class="nav-label">Моряки</span> </a>
    </li>
    {% endif %}
    <li>
        <a href="/mariner/certification/"><i class="fa fa-edit"></i> <span class="nav-label">Сертифiкати</span></a>
    </li>
    {% if user.groups.all.0.name == 'Адміністратор' %}
    <li>
        <a href="/mariner/regulations/"><i class="fa fa-database"></i> <span class="nav-label">Нормативнi документы</span></a>
    </li>
    {% endif %}
{% endblock %}

{% block content %}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Моряк</h2>
        <ol class="breadcrumb">
            <li>
                <a href="/mariner/">Головна</a>
            </li>
            <li>
                <a href="/mariner/sailors/">Моряки</a>
            </li>
            <li class="active">
                <strong>Моряк</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>

<p></p>


<div class="row">
	<div class="col-lg-12">
        <div class="ibox-title">

            <form method="post" novalidate>
                {% csrf_token %}

                {% for hidden_field in form.hidden_fields %}
                    {{ hidden_field }}
                {% endfor %}

                {% if form.non_field_errors %}
                    <div class="alert alert-danger" role="alert">
                        {% for error in form.non_field_errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}

                    <div class="row">
                        <div class="col-md-4">
                            <label class="font-normal">{{ form.first_name_en.label_tag }}</label>
                            {% if form.is_bound %}
                                    {% if form.first_name_en.errors %}
                                        <div class="form-group has-error">
                                            {% render_field form.first_name_en class="form-control is-invalid" %}
                                        </div>
                                        {% for error in form.first_name_en.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div>
                                            {% render_field form.first_name_en class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div>
                                        {{ form.first_name_en|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.first_name_en.help_text %}
                                    <small class="form-text text-muted">{{ form.first_name_en.help_text }}</small>
                                {% endif %}
                        </div>

                        <div class="col-md-4">
                            <label class="font-normal">{{ form.last_name_en.label_tag }}</label>
                            {% if form.is_bound %}
                                    {% if form.last_name_en.errors %}
                                        <div class="form-group has-error">
                                            {% render_field form.last_name_en class="form-control is-invalid" %}
                                        </div>
                                        {% for error in form.last_name_en.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div>
                                            {% render_field form.last_name_en class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div>
                                        {{ form.last_name_en|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.last_name_en.help_text %}
                                    <small class="form-text text-muted">{{ form.last_name_en.help_text }}</small>
                                {% endif %}
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>

                    <div class="row">
                        <div class="col-md-4">
                            <label class="font-normal">{{ form.last_name_ukr.label_tag }}</label>
                            {% if form.is_bound %}
                                    {% if form.last_name_ukr.errors %}
                                        <div class="form-group has-error">
                                            {% render_field form.last_name_ukr class="form-control is-invalid" %}
                                        </div>
                                        {% for error in form.last_name_ukr.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div>
                                            {% render_field form.last_name_ukr class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div>
                                        {{ form.last_name_ukr|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.last_name_ukr.help_text %}
                                    <small class="form-text text-muted">{{ form.last_name_ukr.help_text }}</small>
                                {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label class="font-normal">{{ form.first_name_ukr.label_tag }}</label>
                            {% if form.is_bound %}
                                    {% if form.first_name_ukr.errors %}
                                        <div class="form-group has-error">
                                            {% render_field form.first_name_ukr class="form-control is-invalid" %}
                                        </div>
                                        {% for error in form.first_name_ukr.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div>
                                            {% render_field form.first_name_ukr class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div>
                                        {{ form.first_name_ukr|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.first_name_ukr.help_text %}
                                    <small class="form-text text-muted">{{ form.first_name_ukr.help_text }}</small>
                                {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label class="font-normal">{{ form.second_name_ukr.label_tag }}</label>
                                {% if form.is_bound %}
                                    {% if form.second_name_ukr.errors %}
                                        <div class="form-group has-error">
                                            {% render_field form.second_name_ukr class="form-control is-invalid" %}
                                        </div>
                                        {% for error in form.second_name_ukr.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div>
                                            {% render_field form.second_name_ukr class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div>
                                        {{ form.second_name_ukr|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.second_name_ukr.help_text %}
                                    <small class="form-text text-muted">{{ form.second_name_ukr.help_text }}</small>
                                {% endif %}
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group" id="data_1">
                                <label class="font-normal">{{ form.born.label_tag }}</label>
                                {% if form.is_bound %}
                                    {% if form.born.errors %}
                                    <div class="form-group has-error">
                                        <div class="input-group date">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            {% render_field form.born class="form-control is-invalid" %}
                                        </div>
                                    </div>
                                        {% for error in form.born.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="input-group date">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            {% render_field form.born class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div class="input-group date">
                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        {{ form.born|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.born.help_text %}
                                    <small class="form-text text-muted">{{ form.born.help_text }}</small>
                                {% endif %}
                                
                            </div>
                        </div>

                        <!-- <div class="col-md-4">
                            <div class="form-group" id="data_1">
                                <label class="font-normal">{{ form.died.label_tag }}</label>
                                {% if form.is_bound %}
                                    {% if form.died.errors %}
                                    <div class="form-group has-error">
                                        <div class="input-group date">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            {% render_field form.died class="form-control is-invalid" %}
                                        </div>
                                    </div>
                                        {% for error in form.died.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="input-group date">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            {% render_field form.died class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div class="input-group date">
                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        {{ form.died|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.died.help_text %}
                                    <small class="form-text text-muted">{{ form.died.help_text }}</small>
                                {% endif %}
                                
                            </div>
                        </div> -->

                        <div class="col-md-4">
                            <label class="font-normal">{{ form.inn.label_tag }}</label>
                                {% if form.is_bound %}
                                    {% if form.inn.errors %}
                                        <div class="form-group has-error">
                                            {% render_field form.inn class="form-control is-invalid" %}
                                        </div>
                                        {% for error in form.inn.errors %}
                                            <div class="invalid-feedback">
                                                <p class="text-warning">{{ error }}</p>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div>
                                            {% render_field form.inn class="form-control is-valid" %}
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <div>
                                        {{ form.inn|add_class:"form-control" }}
                                    </div>
                                {% endif %}

                                {% if form.inn.help_text %}
                                    <small class="form-text text-muted">{{ form.inn.help_text }}</small>
                                {% endif %}
                        </div>
                    </div>

                    <div class="form-group text-center m-t-30">
                        <div class="text-center">
                            <button class="btn btn-primary " type="submit"><i class="fa fa-check"></i>&nbsp;Зберегти</button>
                            <a href="{% url 'crm_sailors' %}"><button class="btn btn-info " type="button">Скасувати</button></a>
                        </div>
                    </div>
                    <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
            </form>

    </div>  
    <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <p></p>
                </div>
            </div>
    </div>
    <div class="col-lg-2">
    
    </div> 
 <p></p>    
</div>

{% endblock %}

{% block scripts %}
<!-- Date Picker-->
<script src="/static/js/plugins/datapicker/bootstrap-datepicker.js"></script>
<!-- Input Mask-->
<script src="/static/js/plugins/jasny/jasny-bootstrap.min.js"></script>
<script src="/static/js/templates/validation.js"></script>
<script>
        $(document).ready(function(){

            $.fn.datepicker.dates['itcsUkr'] = {
                days: ["Неділя", "Понеділок", "Вівторок", "Середа", "Четвер", "П’ятниця", "Субота"],
                daysShort: ["НД", "ПН", "ВТ", "СР", "ЧТ", "ПТ", "СБ"],
                daysMin: ["НД", "ПН", "ВТ", "СР", "ЧТ", "ПТ", "СБ"],
                months: ["Січень", "Лютий", "Березень", "Квітень", "Травень", "Червень", "Липень", "Серпень", "Вересень", "Жовтень", "Листопад", "Грудень"],
                monthsShort: ["Сiч", "Лют", "Бер", "Квіт", "Трав", "Черв", "Лип", "Серп", "Вер", "Жовт", "Лист", "Груд"],
                today: "Сьогодні",
                clear: "Очистити",
                format: "mm/dd/yyyy",
                titleFormat: "MM yyyy", /* Leverages same syntax as 'format' */
                weekStart: 0
            };

            $('#data_1 .input-group.date').datepicker({
                language: 'itcsUkr',
                todayBtn: 'linked',
                keyboardNavigation: false,
                forceParse: false,
                calendarWeeks: true,
                autoclose: true,
                format: 'dd.mm.yyyy',
                endDate: '-16y',
            });

            $("#id_last_name_ukr").change(function () {
                var url = '{% url 'ajax_transliteration' %}';
                $.ajax({ 
                    url: url,
                    data: {
                    'fieldData': $(this).val()
                    },
                    dataType: 'json',
                    success: function (data) {
                        $('#id_last_name_en').val(data.transliteration);
                    }
                });
            });

            $("#id_first_name_ukr").change(function () {
                var url = '{% url 'ajax_transliteration' %}';
                $.ajax({ 
                    url: url,
                    data: {
                    'fieldData': $(this).val()
                    },
                    dataType: 'json',
                    success: function (data) {
                        $('#id_first_name_en').val(data.transliteration);
                    }
                });
            });

            $("#id_first_name_en").change(function () {
                var url = '{% url 'ajax_check_certificate' %}';
                $.ajax({ 
                    url: url,
                    data: {
                    'fieldName': 'first_name_en',
                    'fieldData': $(this).val()
                    },
                    dataType: 'json',
                    success: function (data) {
                        if(data.error){
                            // alert(data.error_message);
                            setTimeout(function() {
                                toastr.options = {
                                // closeButton: true,
                                // progressBar: true,
                                // showMethod: 'slideDown',
                                // timeOut: 2000
                                closeButton: true,
                                debug: false,
                                newestOnTop: true,
                                progressBar: false,
                                positionClass: "toast-top-right",
                                preventDuplicates: false,
                                onclick: null,
                                showDuration: 300,
                                hideDuration: 1000,
                                timeOut: 5000,
                                extendedTimeOut: 1000,
                                showEasing: "swing",
                                hideEasing: "linear",
                                showMethod: "fadeIn",
                                hideMethod: "fadeOut"
                                };toastr.warning(data.error_message, 'Помилка у First Name');
                            }, 100);
                        }
                    }
                });
            });

            $("#id_last_name_en").change(function () {
                var url = '{% url 'ajax_check_certificate' %}';
                $.ajax({ 
                    url: url,
                    data: {
                    'fieldName': 'last_name_en',
                    'fieldData': $(this).val()
                    },
                    dataType: 'json',
                    success: function (data) {
                        if(data.error){
                            // alert(data.error_message);
                            setTimeout(function() {
                                toastr.options = {
                                // closeButton: true,
                                // progressBar: true,
                                // showMethod: 'slideDown',
                                // timeOut: 2000
                                closeButton: true,
                                debug: false,
                                newestOnTop: true,
                                progressBar: false,
                                positionClass: "toast-top-right",
                                preventDuplicates: false,
                                onclick: null,
                                showDuration: 300,
                                hideDuration: 1000,
                                timeOut: 5000,
                                extendedTimeOut: 1000,
                                showEasing: "swing",
                                hideEasing: "linear",
                                showMethod: "fadeIn",
                                hideMethod: "fadeOut"
                                };toastr.warning(data.error_message, 'Помилка у First Name');
                            }, 100);
                        }
                    }
                });
            });

        });
    
</script>
{% endblock %}
